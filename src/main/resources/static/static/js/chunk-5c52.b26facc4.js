(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-5c52"],{TS3p:function(t,e,n){"use strict";n.r(e);var a=n("XINx"),r=n("b6Zz"),i=n("rG1V"),o=n("7Qib"),c=n("X4fA"),s={name:"TotalCharts",directives:{elDragDialog:a.a},components:{TraceRelation:r.default},data:function(){return{myChart:"",tableHeight:innerHeight-310,bodyWidth:window.screen.width,dialogVisible:!1,flag:!1,pageNum:1,tankNo:"",username:"admin",cycleList:[],detailList:[]}},mounted:function(){this.username=Object(c.b)()},activated:function(){this.myChart&&this.getTankNo(1,this.tankNo)},methods:{getTankNo:function(t,e){var n=this;this.cycleList=[],this.pageNum=t,this.tankNo=e;var a={tankNo:this.tankNo,pageNum:this.pageNum};this.myChart&&(this.myChart.clear(),this.myChart.dispose()),Object(i.b)(a).then(function(t){n.flag=n.pageNum<t.info.totalPage;var e=t.info.list;if(e.length>0){var a=[],r=[],i=[],o=[];e.forEach(function(t,e){if(t.innerCorrectingDTOs.length>0){var c=t.cycleId;n.cycleList.push({delivery:"周期"+t.deliveryId,cycleId:t.cycleId});var s=t.innerCorrectingDTOs[0].startLevel,l=t.innerCorrectingDTOs[0].startLevel,u=t.innerCorrectingDTOs[0].startTime,d=t.innerCorrectingDTOs[0].startTime;t.innerCorrectingDTOs.forEach(function(e,n){u=u<e.dbInventoryTrace.startTime?u:e.dbInventoryTrace.startTime,d=d>e.dbInventoryTrace.startTime?d:e.dbInventoryTrace.startTime,s=s<e.dbInventoryTrace.startLevel?s:e.dbInventoryTrace.startLevel,l=l>e.dbInventoryTrace.startLevel?l:e.dbInventoryTrace.startLevel,t.innerCorrectingDTOs.length,a.push({value:[e.dbInventoryTrace.startTime,e.dbInventoryTrace.startLevel,t.cycleId]}),r.push({value:[e.dbInventoryTrace.endTime,e.inventoryRate.toFixed(3)]}),i.push({value:[e.dbInventoryTrace.endTime,e.outRate.toFixed(3)]})}),o.push([{name:"周期"+t.deliveryId,value:c,coord:[u,Math.floor(s)]},{coord:[d,Math.ceil(l)]}])}}),n.detailList=e,n.initCharts("charts",a,r,i,o,e)}else n.$message.success("暂无数据")})},initCharts:function(t,e,n,a,r,i){var o=this.modifyData(e,n,a);this.myChart=this.$echarts.init(document.getElementById(t));var c=[],s=[];o[0].forEach(function(t,e){""!==t&&(c.push(e),s.push(t))});var l=c.map(function(t,e){return{source:c[e],target:c[e+1],lineStyle:{width:5,curveness:0,color:"#0073b5"}}}),u=s,d=u[0]?u[0]:u[1],h=u[0]?u[0]:u[1];u.forEach(function(t){d=d>t?t:d,h=h<t?t:h}),r&&r.forEach(function(t){t[0].coord[1]=Math.floor(d),t[1].coord[1]=Math.ceil(h)});var m={color:["#C23531","#2F4554","#D48265"],legend:{data:["液位高度变化曲线","付油组mm变化率","液位组mm变化率"]},grid:{left:"5%",bottom:"3%",right:"5%",containLabel:!0},tooltip:{formatter:function(t){return"graph"===t.componentSubType&&"node"===t.dataType?"时间:"+t.name+"<br/>高度:"+t.data:"graph"===t.componentSubType&&"edge"===t.dataType?"":"line"===t.seriesType?"时间:"+t.name+"<br/>mm变化率:"+t.data:"点击查看该周期"}},xAxis:{type:"category",boundaryGap:!1,data:o[3]},yAxis:[{type:"value",name:"液位高度(mm)",position:"left",min:Math.floor(d),max:Math.ceil(h)},{type:"value",name:"△V/△H",position:"right"}],dataZoom:"oneCycle"===t?[{type:"inside",start:0,end:100}]:null,series:[{name:"液位高度变化曲线",type:"graph",layout:"none",coordinateSystem:"cartesian2d",symbolSize:4,label:{show:!1},edgeSymbol:["circle","arrow"],edgeSymbolSize:[4,10],data:o[0],links:l,lineStyle:{color:"#2f4554"},markArea:{data:r,itemStyle:{color:"rgba(128, 128, 128, 0.1)"}}},{name:"付油组mm变化率",data:o[1],yAxisIndex:1,type:"line",connectNulls:!0,stack:"1",smooth:!0},{name:"液位组mm变化率",data:o[2],yAxisIndex:1,type:"line",connectNulls:!0,stack:"2",smooth:!0}]};this.myChart.setOption(m);var p=this;window.onresize=function(){p.tankSeqLineCharts&&p.tankSeqLineCharts.resize()},p.myChart.on("click",function(t){"markArea"===t.componentType?setTimeout(function(){p.handleSingle(i,t.value)},300):"graph"===t.seriesType&&"edge"===t.dataType&&"admin"===p.username&&setTimeout(function(){var e=i.innerCorrectingDTOs[t.dataIndex];if(e){var n={id:e.group.outRelTraceId,traceId:e.group.traceId,outGroupId:e.group.outGroupId,tankNo:e.group.tankNo,outGroup:{startTime:e.group.startTime,endTime:e.group.endTime,volume:e.group.volume},trace:{startTime:e.dbInventoryTrace.startTime,endTime:e.dbInventoryTrace.endTime}};p.$refs.relationDialog.getData(n,"totalCharts")}},300)})},modifyData:function(t,e,n){var a=[],r=[];[t,e,n].forEach(function(t,e){r.push([]),t.forEach(function(t){a.push(t.value[0]),r[e].push({time:t.value[0],value:t.value[1]})}),r[e]=r[e].sort(function(t,e){return t.time<e.time?1:-1}).reverse()});var i=r[0],c=r[1],s=r[2];(a=Object(o.b)(a.sort(function(t,e){return t<e?1:-1}).reverse())).forEach(function(t,e){t!==(i[e]?i[e].time:"")&&i.splice(e,0,{}),t!==(c[e]?c[e].time:"")&&c.splice(e,0,{}),t!==(s[e]?s[e].time:"")&&s.splice(e,0,{})});for(var l=[i,c,s],u=[],d=function(t){u.push([]),l[t].forEach(function(e){u[t].push(e.time?e.value:"")})},h=0;h<l.length;h++)d(h);return u.push(a),u},toSingleCycle:function(t){this.handleSingle(this.detailList,t.cycleId)},handleSingle:function(t,e){var n=this,a=t.find(function(t){return t.cycleId===e});this.dialogVisible=!0,this.$nextTick(function(){var t=[],e=[],r=[];a.innerCorrectingDTOs.forEach(function(n,i){i!==a.innerCorrectingDTOs.length-1?t.push({value:[n.dbInventoryTrace.startTime,n.dbInventoryTrace.startLevel]}):t.push({value:[n.dbInventoryTrace.startTime,n.dbInventoryTrace.startLevel]},{value:[n.dbInventoryTrace.endTime,n.dbInventoryTrace.endLevel]}),e.push({value:[n.dbInventoryTrace.startTime,n.inventoryRate.toFixed(3)]}),r.push({value:[n.dbInventoryTrace.startTime,n.outRate.toFixed(3)]})}),n.initCharts("oneCycle",t,e,r,null,a)})},compare:function(t,e){return t-e},closeAllDia:function(t){t&&this.getTankNo(1,this.tankNo),this.dialogVisible=!1},prePage:function(){this.getTankNo(--this.pageNum,this.tankNo)},nextPage:function(){this.getTankNo(++this.pageNum,this.tankNo)}}},l=(n("bXh0"),n("KHd+")),u=Object(l.a)(s,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"container"}},[n("el-button-group",{staticClass:"btnGroup"},t._l(t.cycleList,function(e,a){return n("el-tooltip",{key:a,staticClass:"item",attrs:{effect:"dark",content:"点击查看该周期",placement:"top"}},[n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(n){t.toSingleCycle(e)}}},[t._v("\n        "+t._s(e.delivery)+"\n      ")])],1)})),t._v(" "),n("div",{style:"width:"+t.bodyWidth+"px;height:"+t.tableHeight+"px",attrs:{id:"charts"}}),t._v(" "),n("el-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],attrs:{visible:t.dialogVisible,title:"单个周期详情",width:"1000px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[n("div",{staticStyle:{width:"990px",height:"600px"},attrs:{id:"oneCycle"}})]),t._v(" "),n("trace-relation",{ref:"relationDialog",on:{closeAllDia:t.closeAllDia}}),t._v(" "),n("div",{staticStyle:{"margin-top":"10px"}},[t.flag?n("el-button",{staticStyle:{float:"right","margin-left":"10px"},attrs:{type:"primary"},on:{click:t.nextPage}},[t._v("\n      下一页\n    ")]):t._e(),t._v(" "),t.pageNum>1?n("el-button",{staticStyle:{float:"right"},attrs:{type:"primary"},on:{click:t.prePage}},[t._v("\n      上一页\n    ")]):t._e()],1)],1)},[],!1,null,"b7a1387a",null);u.options.__file="index.vue";e.default=u.exports},bXh0:function(t,e,n){"use strict";var a=n("lwls");n.n(a).a},lwls:function(t,e,n){},rG1V:function(t,e,n){"use strict";n.d(e,"b",function(){return r}),n.d(e,"c",function(){return i}),n.d(e,"e",function(){return o}),n.d(e,"a",function(){return c}),n.d(e,"d",function(){return s}),n.d(e,"f",function(){return l});var a=n("t3Un");function r(t){return Object(a.a)({url:"/correcting/select",method:"get",params:t})}function i(t){return Object(a.a)({url:"/correcting/selecttable",method:"get",params:t})}function o(t){return Object(a.a)({url:"/correcting/update",method:"post",data:t})}function c(t){return Object(a.a)({url:"/tankchartdc/export/export",method:"post",data:t})}function s(t){return Object(a.a)({url:"/tankchartdc/inventoryCycle/select",method:"get",params:t})}function l(t){return Object(a.a)({url:"/tankchartdc/export/select",method:"get",params:t})}}}]);