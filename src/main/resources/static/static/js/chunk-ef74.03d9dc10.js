(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-ef74"],{EXfU:function(t,e,a){"use strict";a.r(e);var l=a("gDS+"),i=a.n(l),o=a("P2sY"),s=a.n(o),n=a("14Xm"),r=a.n(n),c=a("D3Ub"),d=a.n(c),u=a("XINx"),m=a("Vt1q"),f=a("JjGQ"),p=a("31As"),b={name:"TankDevice",directives:{elDragDialog:u.a},components:{RelationComponent:p.default},data:function(){var t=this,e=function(e,a,l){""!==a&&t.getByteLen(a)>20?"probeManufactor"===e.field?l("液位仪厂家超过指定长度"):"probeType"===e.field&&l("液位仪型号超过指定长度"):l()};return{loading:!1,bodyWidth:window.screen.width-13,addTankDevice:[],formLabelWidthGuan:"100px",formLabelWidthDia:"120px",allDisable:!0,companyOptions:[],dialogFormVisible:!1,oilId:"",oilCode:"",oilName:"",form:{id:"",tankNo:"",detailInfo:"",productType:"",oilId:"",oilCode:"",oilName:"",status:{value:1},diameter:"",maxVolume:"",waterBlind:"",oilBlind:"",highOilAlarm:"",highOilWarn:"",lowOilWarn:"",lowOilAlarm:"",highWaterAlarm:"",installTime:"",checkTime:"",maintenanceManagerId:"",probeManufactor:"",probeType:"",validity:""},formRules:{tankNo:[{validator:function(e,a,l){""===a||null===a||void 0===a?l("油罐编号不能为空"):Number(a)?t.getByteLen(a)>10?l("油罐编号超过指定长度"):t.validateStationData[e.field]!==a?Object(m.c)({tankNo:a}).then(function(t){"fail"===t.info.result?l("油罐编号已存在"):l()}):l():l("编码必须是数字格式")},required:!0,trigger:"change"}],detailInfo:[{validator:function(e,a,l){""===a||null===a||void 0===a?l("油罐名称不能为空"):t.getByteLen(a)>10?l("油罐名称超过指定长度"):t.validateStationData[e.field]!==a?Object(m.c)({detailInfo:a}).then(function(t){"fail"===t.info.result?l("油罐名称已存在"):l()}):l()},required:!0,trigger:"change"}],diameter:[{validator:e,required:!1,trigger:"blur"}],probeManufactor:[{validator:e,required:!1,trigger:"blur"}],probeType:[{validator:e,required:!1,trigger:"blur"}]},editBtnFlag:!1,oilList:[],dialogTitle:"添加油罐",handleFlag:!1,validateStationData:{tankNo:"",detailInfo:""},fileList:[],dialogTankTableVisible:!1,dialogTankTableTitle:"查看容积表",tankTableList:[]}},created:function(){this.getAllTankList()},methods:{getAllTankList:function(){var t=this;d()(r.a.mark(function e(){var a,l;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,e.prev=1,a={status:1,isPage:!1},e.next=5,Object(f.d)(a);case 5:return l=e.sent,t.oilList=l.list,e.next=9,Object(m.f)();case 9:t.addTankDevice=e.sent,t.addTankDevice.forEach(function(e){e.relNozListsStr=e.relNozLists.join(",");var a=t.oilList.find(function(t){return t.code===e.oilCode});e.oilName=a?a.fullName:"",null===e.status&&(e.status={value:""})}),t.loading=!1,e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1);case 17:case"end":return e.stop()}},e,t,[[1,14]])}))()},changeOil:function(t){var e=this;this.oilList.forEach(function(a){a.id===t&&(e.form.oilName=a.fullName,e.form.oilCode=a.code)})},editTankBtn:function(t){var e=this;this.fileList=[],this.handleFlag=!0,this.dialogTitle="编辑油罐",this.dialogFormVisible=!0,this.$nextTick(function(){void 0!==e.$refs.form&&(e.form.status={value:t.status.value},e.$refs.form.resetFields(),e.form=s()({},t),e.form.validity=t.validity||90,e.validateStationData.tankNo=t.tankNo,e.validateStationData.detailInfo=t.detailInfo)})},addTank:function(){var t=this;this.handleFlag=!1,this.dialogTitle="添加油罐",this.$nextTick(function(){void 0!==t.$refs.form&&(t.$refs.form.resetFields(),t.form.status={value:1},t.form.oilCode=""),t.form.validity=90}),this.fileList=[],this.validateStationData.tankNo="",this.validateStationData.detailInfo="",this.dialogFormVisible=!0},submit:function(){var t=this;this.form.maxVolume>6e4?this.$confirm("最大罐容超过60000,是否继续?","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(function(){t.commit()}).catch(function(){}):this.commit()},commit:function(){var t=this;this.$refs.form.validate(function(e){if(!e)return!1;var a=s()({},t.form);a.status=1===t.form.status.value?"ENABLE":"DISABLE",a.deviceType="TANK";var l=new FormData;l.append("profile",t.fileList[0]),l.append("tankInfo",i()(a)),t.handleFlag?Object(m.b)(l).then(function(e){"success"===e.info.result&&(t.$message({message:"修改成功",type:"success"}),t.getAllTankList(),t.dialogFormVisible=!1)}):Object(m.a)(l).then(function(e){"success"===e.info.result&&(t.$message({message:"修改成功",type:"success"}),t.continueTip())})})},continueTip:function(){var t=this;this.$confirm("添加成功, 是否继续添加?","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"success"}).then(function(){t.getAllTankList(),t.form.status={value:1},t.$refs.form.resetFields(),t.form.oilId="",t.form.validity=90,t.fileList=[]}).catch(function(){t.getAllTankList(),t.dialogFormVisible=!1})},cancel:function(){this.getAllTankList(),this.dialogFormVisible=!1},getByteLen:function(t){return(t+="").replace(/[\u4E00-\uFFE5]/g,"aa").length},beforeUpload:function(t){return t.size/1024<500?"text/plain"===t.type||"application/vnd.ms-excel"===t.type||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===t.type?(this.fileList.push(t),!1):void this.$message.error(this.$t("versionMage.input_right_type")+"(.txt/.csv/.xls/.xlsx)"):(this.$message({message:this.$t("tank_table_para.file_limit7"),type:"error"}),!1)},handleExceed:function(t,e){this.$message.warning(this.$t("versionMage.limit_file")+(t.length+e.length)+this.$t("versionMage.file_num"))},beforeRemove:function(t,e){if(t&&"success"===t.status)return this.$confirm(this.$t("tank_table_para.confirm_delete")+""+t.name+"？")},handleRemove:function(t){t&&"success"===t.status&&(this.fileList=[])},lookTankTableDetail:function(t){var e=this;d()(r.a.mark(function a(){var l,i,o,s,n;return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,e.tankTableList=[],a.next=4,Object(m.g)({tankCode:t.tankNo});case 4:l=a.sent,e.tankTableList=l.records,e.tankTableList.forEach(function(t){t.hvTableData=[],t.hV.split("|").forEach(function(e){t.hvTableData.push({h:e.split(",")[0],v:e.split(",")[1]})})}),i=[],o=[],s=[],n=[],e.tankTableList.forEach(function(t){if(t.hvTableData.length>=20){var e=t.hvTableData.length,a=parseInt(e/4),l=e%4;i=t.hvTableData.splice(0,l>=1?a+1:a),o=t.hvTableData.splice(0,l>=2?a+1:a),s=t.hvTableData.splice(0,l>=3?a+1:a);var r=t.hvTableData.length;n=t.hvTableData.splice(0,r),t.hvTableData.push(i,o,s,n)}else i=t.hvTableData.splice(0,t.hvTableData.length),t.hvTableData.push(i)}),e.dialogTankTableTitle=t.tankNo+"号罐容积表",e.dialogTankTableVisible=!0,a.next=20;break;case 17:a.prev=17,a.t0=a.catch(0);case 20:case"end":return a.stop()}},a,e,[[0,17]])}))()},versionCtl:function(t){return"版本 "+((t+"").includes(".")?t:t+".0")},goRelationshipComponent:function(t,e){this.$refs.relation.gunTankRelationship(t,"tank","look",e)}}},v=(a("v0vV"),a("KHd+")),h=Object(v.a)(b,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-button",{staticStyle:{float:"right","margin-bottom":"10px"},attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:t.addTank}},[t._v("\n    添加\n  ")]),t._v(" "),a("div",{staticStyle:{clear:"both"}}),t._v(" "),a("el-row",{style:"margin-bottom: 20px;width:"+t.bodyWidth+"px",attrs:{"v-loading":t.loading,gutter:10}},t._l(t.addTankDevice,function(e,l){return a("el-col",{key:l,staticStyle:{"margin-bottom":"10px"},attrs:{span:12}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticStyle:{"font-size":"18px"}},[t._v(t._s(e.tankNo)+"号罐")]),t._v(" "),a("el-button",{staticStyle:{float:"right",padding:"3px 15px"},attrs:{type:"text"},on:{click:function(a){t.lookTankTableDetail(e)}}},[t._v("\n            查看容积表\n          ")]),t._v(" "),a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:function(a){t.goRelationshipComponent(e.tankNo,e)}}},[t._v("\n            枪罐关系\n          ")]),t._v(" "),a("el-button",{staticStyle:{float:"right",padding:"3px 15px"},attrs:{type:"text"},on:{click:function(a){t.editTankBtn(e)}}},[t._v("\n            编辑\n          ")])],1),t._v(" "),a("el-form",[t._e(),t._v(" "),a("el-row",[a("el-col",{attrs:{xl:8,lg:12}},[a("el-form-item",{staticClass:"inputSty",attrs:{"label-width":t.formLabelWidthGuan,label:t.$t("oil.code")}},[a("el-input",{staticStyle:{width:"135px"},attrs:{readonly:"",size:"small"},model:{value:e.tankNo,callback:function(a){t.$set(e,"tankNo","string"==typeof a?a.trim():a)},expression:"item.tankNo"}})],1)],1),t._v(" "),a("el-col",{attrs:{xl:8,lg:12}},[a("el-form-item",{staticClass:"inputSty",attrs:{"label-width":t.formLabelWidthGuan,label:"名称"}},[a("el-input",{staticStyle:{width:"135px"},attrs:{readonly:"",size:"small"},model:{value:e.detailInfo,callback:function(a){t.$set(e,"detailInfo",a)},expression:"item.detailInfo"}})],1)],1),t._v(" "),a("el-col",{attrs:{xl:8,lg:12}},[a("el-form-item",{staticClass:"inputSty",attrs:{"label-width":t.formLabelWidthGuan,label:t.$t("alarmParam.oil")}},[a("el-input",{staticStyle:{width:"135px"},attrs:{readonly:"",size:"small"},model:{value:e.oilName,callback:function(a){t.$set(e,"oilName",a)},expression:"item.oilName"}})],1)],1),t._v(" "),a("el-col",{attrs:{xl:8,lg:12}},[a("el-form-item",{staticClass:"inputSty",attrs:{"label-width":t.formLabelWidthGuan,label:t.$t("station_all.diameter")}},[a("el-input",{staticStyle:{width:"135px"},attrs:{readonly:"",size:"small"},model:{value:e.diameter,callback:function(a){t.$set(e,"diameter",a)},expression:"item.diameter"}})],1)],1),t._v(" "),a("el-col",{attrs:{xl:8,lg:12}},[a("el-form-item",{staticClass:"inputSty",attrs:{"label-width":t.formLabelWidthGuan,label:"最大罐容(L)"}},[a("el-input",{staticStyle:{width:"135px"},attrs:{readonly:"",size:"small"},model:{value:e.maxVolume,callback:function(a){t.$set(e,"maxVolume",a)},expression:"item.maxVolume"}})],1)],1),t._v(" "),a("el-col",{attrs:{xl:8,lg:12}},[a("el-form-item",{staticClass:"inputSty",attrs:{"label-width":t.formLabelWidthGuan,label:"液位仪厂家"}},[a("el-input",{staticStyle:{width:"135px"},attrs:{readonly:"",size:"small"},model:{value:e.probeManufactor,callback:function(a){t.$set(e,"probeManufactor",a)},expression:"item.probeManufactor"}})],1)],1),t._v(" "),a("el-col",{attrs:{xl:8,lg:12}},[a("el-form-item",{staticClass:"inputSty",attrs:{"label-width":t.formLabelWidthGuan,label:"液位仪型号"}},[a("el-input",{staticStyle:{width:"135px"},attrs:{readonly:"",size:"small"},model:{value:e.probeType,callback:function(a){t.$set(e,"probeType",a)},expression:"item.probeType"}})],1)],1),t._v(" "),a("el-col",{attrs:{xl:8,lg:12}},[a("el-form-item",{staticClass:"inputSty",attrs:{"label-width":t.formLabelWidthGuan,label:"关联油枪"}},[a("el-input",{staticStyle:{width:"135px"},attrs:{readonly:"",size:"small"},model:{value:e.relNozListsStr,callback:function(a){t.$set(e,"relNozListsStr",a)},expression:"item.relNozListsStr"}})],1)],1),t._v(" "),a("el-col",{attrs:{xl:8,lg:12}},[a("el-form-item",{staticClass:"inputSty radioSty",attrs:{"label-width":t.formLabelWidthGuan,label:t.$t("distribution_warn.status")}},[a("el-radio-group",{attrs:{disabled:""},model:{value:e.status.value,callback:function(a){t.$set(e.status,"value",a)},expression:"item.status.value"}},[a("el-radio",{attrs:{label:1,size:"small"}},[t._v("\n                    "+t._s(t.$t("table.able"))+"\n                  ")]),t._v(" "),a("el-radio",{attrs:{label:0,size:"small"}},[t._v("\n                    "+t._s(t.$t("table.disable"))+"\n                  ")])],1)],1)],1)],1)],1)],1)],1)})),t._v(" "),a("el-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],attrs:{visible:t.dialogFormVisible,title:t.dialogTitle,width:"1100px"},on:{"update:visible":function(e){t.dialogFormVisible=e},close:t.cancel}},[a("el-form",{ref:"form",attrs:{model:t.form,rules:t.formRules}},[t._e(),t._v(" "),a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{staticClass:"inputSty",attrs:{"label-width":t.formLabelWidthDia,label:t.$t("oil.code"),prop:"tankNo"}},[a("el-input",{staticStyle:{width:"135px"},attrs:{disabled:t.handleFlag,size:"small"},model:{value:t.form.tankNo,callback:function(e){t.$set(t.form,"tankNo","string"==typeof e?e.trim():e)},expression:"form.tankNo"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{staticClass:"inputSty",attrs:{"label-width":t.formLabelWidthDia,label:"名称",prop:"detailInfo"}},[a("el-input",{staticStyle:{width:"135px"},attrs:{size:"small"},model:{value:t.form.detailInfo,callback:function(e){t.$set(t.form,"detailInfo",e)},expression:"form.detailInfo"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{staticClass:"inputSty",attrs:{"label-width":t.formLabelWidthDia,label:t.$t("alarmParam.oil"),prop:"oilId"}},[a("el-select",{staticStyle:{width:"135px"},attrs:{size:"small",placeholder:"请选择",filterable:"",clearable:""},on:{change:t.changeOil},model:{value:t.form.oilCode,callback:function(e){t.$set(t.form,"oilCode",e)},expression:"form.oilCode"}},t._l(t.oilList,function(t){return a("el-option",{key:t.code,attrs:{label:t.fullName,value:t.code}})}))],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{staticClass:"inputSty",attrs:{"label-width":t.formLabelWidthDia,label:t.$t("station_all.diameter"),prop:"diameter"}},[a("el-input-number",{staticStyle:{width:"135px"},attrs:{min:0,max:3500,size:"small"},model:{value:t.form.diameter,callback:function(e){t.$set(t.form,"diameter",e)},expression:"form.diameter"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{staticClass:"inputSty",attrs:{"label-width":t.formLabelWidthDia,label:"最大罐容",prop:"maxVolume"}},[a("el-input-number",{staticStyle:{width:"135px"},attrs:{min:0,size:"small"},model:{value:t.form.maxVolume,callback:function(e){t.$set(t.form,"maxVolume",e)},expression:"form.maxVolume"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{staticClass:"inputSty",attrs:{"label-width":t.formLabelWidthDia,label:"液位仪厂家",prop:"probeManufactor"}},[a("el-input",{staticStyle:{width:"135px"},attrs:{size:"small"},model:{value:t.form.probeManufactor,callback:function(e){t.$set(t.form,"probeManufactor",e)},expression:"form.probeManufactor"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{staticClass:"inputSty",attrs:{"label-width":t.formLabelWidthDia,label:"液位仪型号",prop:"probeType"}},[a("el-input",{staticStyle:{width:"135px"},attrs:{size:"small"},model:{value:t.form.probeType,callback:function(e){t.$set(t.form,"probeType",e)},expression:"form.probeType"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{staticClass:"inputSty radioSty",attrs:{"label-width":t.formLabelWidthDia,label:t.$t("distribution_warn.status"),prop:"status.value"}},[a("el-radio-group",{model:{value:t.form.status.value,callback:function(e){t.$set(t.form.status,"value",e)},expression:"form.status.value"}},[a("el-radio",{attrs:{label:1,size:"small"}},[t._v("\n                "+t._s(t.$t("table.able"))+"\n              ")]),t._v(" "),a("el-radio",{attrs:{label:0,size:"small"}},[t._v("\n                "+t._s(t.$t("table.disable"))+"\n              ")])],1)],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{staticClass:"inputSty",attrs:{"label-width":"160px",label:"容积表有效时长（天）",prop:"validity"}},[a("el-input-number",{staticStyle:{width:"135px"},attrs:{size:"small"},model:{value:t.form.validity,callback:function(e){t.$set(t.form,"validity",e)},expression:"form.validity"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-upload",{staticClass:"upload-demo",attrs:{"before-remove":t.beforeRemove,limit:1,"file-list":t.fileList,"on-remove":t.handleRemove,"on-exceed":t.handleExceed,"before-upload":t.beforeUpload,action:""}},[a("el-button",{attrs:{size:"small",type:"primary"}},[t._v("上传容积表")]),t._v(" "),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传txt/csv/xls/xlsx文件,且不超过500kb")])],1)],1)],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.cancel}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("确 定")])],1)],1),t._v(" "),a("el-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],staticClass:"diaSty",attrs:{visible:t.dialogTankTableVisible,title:t.dialogTankTableTitle,width:"951px"},on:{"update:visible":function(e){t.dialogTankTableVisible=e}}},[t.tankTableList.length?a("el-tabs",{staticStyle:{height:"520px"},attrs:{"tab-position":"left"}},t._l(t.tankTableList,function(e){return a("el-tab-pane",{key:e.id,staticStyle:{padding:"0 20px"},attrs:{label:t.versionCtl(e.version)}},[a("div",{staticStyle:{width:"100%",height:"30px"}},[a("span",{staticStyle:{"font-size":"16px"}},[t._v("上传时间："+t._s(e.importTime))]),t._v("\n               \n          "),a("span",{staticStyle:{"font-size":"16px"}},[t._v("有效期长："+t._s(e.validity)+" 天")]),t._v("\n               \n          "),a("span",{staticStyle:{"font-size":"16px"}},[t._v("最大高度："+t._s(e.maxHeight)+" mm")])]),t._v(" "),t._l(e.hvTableData,function(e,l){return a("div",{key:l,staticClass:"tableScroll"},[a("el-table",{staticClass:"tableSty",attrs:{data:e,border:"",height:"480px"}},[a("el-table-column",{attrs:{prop:"h",label:"H(mm)"}}),t._v(" "),a("el-table-column",{attrs:{prop:"v",label:"V(L)"}})],1)],1)})],2)})):a("div",{staticStyle:{width:"100%",height:"300px"}},[a("p",{staticStyle:{padding:"100px 0","text-align":"center","font-size":"18px"}},[t._v("\n        暂无容积表版本\n      ")])]),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogTankTableVisible=!1}}},[t._v("取 消")])],1)],1),t._v(" "),a("relation-component",{ref:"relation"})],1)},[],!1,null,"2ba2adff",null);h.options.__file="tank_device.vue";e.default=h.exports},IDev:function(t,e,a){},JjGQ:function(t,e,a){"use strict";a.d(e,"d",function(){return i}),a.d(e,"c",function(){return o}),a.d(e,"a",function(){return s}),a.d(e,"b",function(){return n});var l=a("t3Un");function i(t){return Object(l.a)({url:"/oil/list",method:"get",params:t})}function o(t){return Object(l.a)({url:"/oil/exist",method:"post",data:t})}function s(t){return Object(l.a)({url:"/oil/add",method:"post",data:t})}function n(t){return Object(l.a)({url:"/oil/update",method:"post",data:t})}},v0vV:function(t,e,a){"use strict";var l=a("IDev");a.n(l).a}}]);